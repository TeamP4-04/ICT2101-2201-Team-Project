{% extends "layout.html" %}
{% block content %}
      <div class="row">
		<div class="col-sm" id="blocklyDiv" style="height: 480px; width: 600px;"> 
			<xml id="toolbox" style="display: none">
				<block type="controls_if"></block>
				<block type="controls_repeat_ext"></block>
				<block type="logic_compare"></block>
				<block type="math_number"></block>
				<block type="math_arithmetic"></block>
				<block type="text"></block>
				<block type="text_print"></block>
			</xml>			  
		</div>
        <div class="col-lg-8">
			<div class="row">
				<div class="col-9">
					<article class="media content-section">
						<div class="media-body">     
							<h2><a class="article-title">Virtual Map</a></h2>
							<div class="content-section">
								<p class='text-muted'>displays here</p>
							</div>
						</div>
					</article>
				</div>
				<div class="col">
					<div class="row">
						<div class="col">
							<div class="content-section">
								<h6>Stages</h6>
								<p class='text-muted'>
								<button type"button">Stage 1</button>
								<button type"button">Stage 2</button>
								<button type"button">Stage 3</button>
								</p>
							 </div>
						</div>
					</div>
					<div class="row">
						<div class="col">
							<div class="content-section">
								<h6>Legend</h6>
								<figure> <p class='noselect'>Car: <img src="https://webkit.org/blog-files/color-gamut/Webkit-logo-P3.png"
								alt="Obstacle"></figure>
								<figure> <p class='noselect'>Obstacle: <img src="https://www.pngkey.com/png/full/816-8162670_light-blue-box-light-blue-overlay-transparent.png"
								style="width:20px;height:30;" alt="Obstacle"></figure>
								<figure> <p class='noselect'>Path Trace: <img src="https://lh3.googleusercontent.com/proxy/awXUqPYwQh3M2dfXvqAouFmWcESAw6heFpjHWJZSqSH1WQ7hUqqxX-4jSOsnE4M2CgE3Nr2USI_c16VAVmmHP6pybazh1pTUP4jp9f6PXKkkTw"
								style="width:20px;height:30;" alt="Obstacle"></figure>
								<figure> <p class='noselect'>Empty Path: <img src="https://www.meme-arsenal.com/memes/c4960a27bdd614f9eec7f1b59deb374b.jpg"
								style="width:20px;height:30;" alt="Obstacle"></figure>
								</p>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
			 <div class="col">
			  <div class="content-section">
				<h6>Distance Travelled</h6>
				<p class='noselect'>{{distance_travelled}}</p> 
			  </div>
			</div>
			<div class="col">
			  <div class="content-section">
				<h6>Rotation</h6>
				<p class='noselect'>{{rotation}}</p>
			  </div>
			</div>
			<div class="col">
			  <div class="content-section">
				<h6>Obstacle Distance</h6>
				<p class='noselect'>{{obstacle_distance}}</p>
			  </div>
			</div>
			<div class="col">
			  <div class="content-section">
				<h6>Acceleration</h6>
				<p class='noselect'>{{acceleration}}</p>
			  </div>
			</div>
			<div class="col">
			  <div class="content-section">
				<h6>Time Spent</h6>
				<p class='noselect'><label id="minutes">00</label>:<label id="seconds">00</label></p>
			  </div>
			</div>
			</div>
		</div>
		 
      </div>
	  <p>
		<button type="button" onclick="run()">Run</button>		
	  </p>
	 
	 
		
			<script>
				var workspace = Blockly.inject('blocklyDiv',
				{toolbox: document.getElementById('toolbox')});
				
				function run(){
					window.LoopTrap = 1000;
					Blockly.Python.INFINITE_LOOP_TRAP = 'if (--window.LoopTrap == 0) throw "Infinite loop.";\n'; 
					var code = Blockly.Python.workspaceToCode(workspace);
					Blockly.Python.INFINITE_LOOP_TRAP = null;
					try {
					<!-- eval runs as actual code so dont do it here -->
						<!--eval(code);
						alert(code);
					} catch (e) {
						alert(e);
					}
				}
				var minutesLabel = document.getElementById("minutes");
				var secondsLabel = document.getElementById("seconds");
				var totalSeconds = 0;
				setInterval(setTime, 1000);

				function setTime() {
					++totalSeconds;
					secondsLabel.innerHTML = pad(totalSeconds % 60);
					minutesLabel.innerHTML = pad(parseInt(totalSeconds / 60));
				}

				function pad(val) {
				var valString = val + "";
				if (valString.length < 2) {
					return "0" + valString;
				} else {
					return valString;
					}
				}
				
			</script>

	  
{% endblock content %}

